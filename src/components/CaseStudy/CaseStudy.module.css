/* ========================================
 * Case Study Hero
 * ======================================== */

.hero {
  padding-top: var(--space-16);
}

.cover + .hero {
  padding-top: var(--space-10);
}

.cover {
  margin-top: var(--space-12);
  margin-bottom: var(--space-12);
}

.coverFrame {
  width: 100%;
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  background: var(--bg-secondary);
  color: var(--text-quaternary);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.coverFrame > * {
  position: relative;
  z-index: 1;
}

.heroTop {
  position: relative;
  padding-bottom: var(--cs-hero-heading-offset, 40px);
}

.heroTop + .hero {
  padding-top: 0;
}

.textLoadIn {
  animation: textBlurInFocus var(--duration-fast) var(--ease-out) backwards;
  animation-delay: calc(var(--duration-fast) / 2);
}

@keyframes textBlurInFocus {
  from {
    opacity: 0;
    filter: blur(8px);
  }
  to {
    opacity: 1;
    filter: none;
  }
}

@media (prefers-reduced-motion: reduce) {
  .textLoadIn {
    animation: none;
  }
}

.heroTop .cover {
  margin-top: 0;
}

@media (min-width: 640px) {
  .heroTop .cover {
    margin-left: calc(-1 * var(--cs-cover-bleed-desktop, 64px));
    margin-right: calc(-1 * var(--cs-cover-bleed-desktop, 64px));
  }
}

.stickyTrack {
  position: relative;
  z-index: 20;
}

.navOverlay {
  position: sticky;
  top: var(--cs-nav-sticky-top, 0px);
  height: 88px;
  z-index: 20;
}

.navOverlay > * {
  position: relative;
  z-index: 1;
}

.blurOverlay {
  position: sticky;
  top: var(--cs-nav-sticky-top, 0px);
  height: var(--cs-blur-band-height, 120px);
  z-index: 15;
  pointer-events: none;
}

.blurOverlay::before {
  content: '';
  position: absolute;
  top: 0;
  height: var(--cs-blur-band-height, 120px);
  left: calc((100vw - 100%) / -2);
  right: calc((100vw - 100%) / -2);
  background: linear-gradient(
    to bottom,
    rgba(255, 255, 255, var(--cs-blur-start-opacity, 0.72)) 0%,
    rgba(255, 255, 255, var(--cs-blur-mid-opacity, 0.34)) var(--cs-blur-mid-stop, 56%),
    rgba(255, 255, 255, 0) 100%
  );
  backdrop-filter: blur(var(--cs-blur-strength, 14px));
  -webkit-backdrop-filter: blur(var(--cs-blur-strength, 14px));
  mask-image: linear-gradient(to bottom, black 0%, black var(--cs-blur-mask-cutoff, 62%), transparent 100%);
  -webkit-mask-image: linear-gradient(to bottom, black 0%, black var(--cs-blur-mask-cutoff, 62%), transparent 100%);
}

@media (prefers-color-scheme: dark) {
  .blurOverlay::before {
    background: linear-gradient(
      to bottom,
      rgba(10, 10, 10, var(--cs-blur-start-opacity, 0.7)) 0%,
      rgba(10, 10, 10, var(--cs-blur-mid-opacity, 0.34)) var(--cs-blur-mid-stop, 56%),
      rgba(10, 10, 10, 0) 100%
    );
  }
}

.heroSeparator {
  display: flex;
  align-items: center;
  gap: var(--space-1);
  margin-top: var(--space-20);
  margin-bottom: var(--space-20);
}

.heroSeparatorRule {
  flex: 1;
  height: 1px;
  background-color: var(--border-primary);
}

/* ========================================
 * Detail Level Toggle (icon buttons â€” hidden)
 * ======================================== */

.detailToggle {
  display: none;
  align-items: flex-start;
  gap: var(--space-2);
}

.detailToggleButton {
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 0;
  border: none;
  background: none;
  color: var(--text-quaternary);
  cursor: pointer;
  border-radius: 0;
  transition: color 150ms ease-out;
}

.detailToggleButton:hover {
  color: var(--text-secondary);
}

.detailToggleButton[data-active] {
  color: var(--text-primary);
}

/* First section after separator - no extra margin since separator provides it */
.firstSection {
  margin-top: 0;
}

.title {
  font-family: var(--font-serif);
  font-size: var(--text-xl);
  font-weight: 400;
  letter-spacing: -0.02em;
  color: var(--text-primary);
  margin-bottom: var(--space-4);
}

.hook {
  font-size: var(--text-base);
  line-height: var(--leading-relaxed);
  color: var(--text-secondary);
  max-width: 32rem;
  margin-bottom: var(--space-12);
}

.meta {
  display: flex;
  gap: var(--space-8);
}

.metaItem {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.metaLabel {
  font-size: var(--text-xs);
  font-weight: 500;
  color: var(--text-quaternary);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.metaValue {
  font-size: var(--text-sm);
  color: var(--text-secondary);
}

/* ========================================
 * Detail Level Segmented Control
 * ======================================== */

 .segmentedControl {
  display: flex;
  position: relative;
  border: 1px solid var(--border-primary);
  border-radius: 999px;
  padding: 3px;
  background: var(--bg-primary);
}

.segmentedIndicator {
  position: absolute;
  top: 3px;
  left: 3px;
  width: calc((100% - 6px) / 3);
  height: calc(100% - 6px);
  background: var(--bg-secondary);
  border-radius: 999px;
  transition: transform 200ms var(--ease-out);
  pointer-events: none;
}

.segmentedButton {
  position: relative;
  z-index: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 24px;
  padding: 0;
  border: none;
  background: none;
  color: var(--text-quaternary);
  cursor: pointer;
  border-radius: 999px;
  transition: color 150ms ease-out;
}

.segmentedButton:hover {
  color: var(--text-secondary);
}

.segmentedButton[data-active] {
  color: var(--text-primary);
}

/* ========================================
 * Chapter
 * ======================================== */

.chapter {
  margin-top: var(--space-12);
}

.chapterHeader {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  margin-bottom: var(--space-6);
}

.chapterTitle {
  font-family: var(--font-sans);
  font-size: var(--text-xs);
  font-weight: 500;
  color: var(--text-quaternary);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: 0;
}

.chapterMeta {
  display: flex;
  align-items: center;
  gap: var(--space-3);
}

.chapterDivider {
  width: 1px;
  height: 14px;
  background-color: var(--border-primary);
}

.chapterCounter {
  font-size: var(--text-xs);
  font-weight: 500;
  color: var(--text-quaternary);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  font-variant-numeric: tabular-nums;
}


/* ========================================
 * Stack Section (shared by Card & Figure stacks)
 * ======================================== */

.stackSection {
  margin-top: var(--space-12);
}

.stackHeader {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  margin-bottom: var(--space-6);
}

.stackTitle {
  font-family: var(--font-sans);
  font-size: var(--text-xs);
  font-weight: 500;
  color: var(--text-quaternary);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin: 0;
}

.stackDivider {
  width: 1px;
  height: 14px;
  background-color: var(--border-primary);
}

.stackCounter {
  font-size: var(--text-xs);
  font-weight: 500;
  color: var(--text-quaternary);
  letter-spacing: 0.08em;
  font-variant-numeric: tabular-nums;
}

/* ========================================
 * Card Stack (Interactive)
 * ======================================== */

.stackContainer {
  display: grid;
  border-radius: 8px;
  /* Reserve space for the stacking offset (3 cards * 8px) */
  padding-right: 24px;
  padding-bottom: 24px;
}

.stackCard {
  grid-area: 1 / 1;
  width: 100%;
  padding: var(--space-6);
  background: var(--bg-primary);
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  opacity: calc(1 - var(--stack-pos) * 0.2) !important;
  transition: 
    transform var(--duration-normal) var(--ease-out),
    opacity var(--duration-normal) var(--ease-out);
  
  /* Position based on stack position */
  transform: translateX(calc(var(--stack-pos) * 8px)) translateY(calc(var(--stack-pos) * 8px));
  z-index: calc(10 - var(--stack-pos));
  opacity: calc(1 - var(--stack-pos) * 0.12);
  
  /* Hide cards beyond position 3 */
  visibility: visible;
}

/* Active card */
.stackCard[data-active="true"] {
  cursor: default;
  z-index: 100;
}

.stackContainer:focus-visible {
  outline: none;
}

.stackContainer:focus-visible .stackCard[data-active="true"] {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* Non-active cards - clickable with circle arrow cursor (mirrored to point right) */
.stackCard:not([data-active="true"]) {
  cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 640 640' fill='%23737373'%3E%3Cpath transform='translate(640,0) scale(-1,1)' d='M320 96C443.7 96 544 196.3 544 320C544 443.7 443.7 544 320 544C196.3 544 96 443.7 96 320C96 196.3 196.3 96 320 96zM320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576zM228.7 308.7C222.5 314.9 222.5 325.1 228.7 331.3L300.7 403.3C306.9 409.5 317.1 409.5 323.3 403.3C329.5 397.1 329.5 386.9 323.3 380.7L278.6 336L400 336C408.8 336 416 328.8 416 320C416 311.2 408.8 304 400 304L278.6 304L323.3 259.3C329.5 253.1 329.5 242.9 323.3 236.7C317.1 230.5 306.9 230.5 300.7 236.7L228.7 308.7z'/%3E%3C/svg%3E") 12 12, pointer;
}

/* Cards far back - hide them */
.stackCard[style*="--stack-pos: 4"],
.stackCard[style*="--stack-pos: 5"],
.stackCard[style*="--stack-pos: 6"],
.stackCard[style*="--stack-pos: 7"] {
  visibility: hidden;
}

.stackCardTitle {
  font-family: var(--font-sans);
  font-size: var(--text-base);
  font-weight: 500;
  color: var(--text-primary);
  letter-spacing: 0;
  margin-bottom: var(--space-2);
}

.stackCardBody {
  font-size: var(--text-base);
  line-height: var(--leading-relaxed);
  color: var(--text-secondary);
  opacity: 0.9;
}

/* ========================================
 * Figure Stack (Interactive)
 * ======================================== */

.figureStackContainer {
  position: relative;
  border-radius: 8px;
  padding-bottom: 24px;
}

.stackFigure {
  position: absolute;
  top: 0;
  left: 0;
  width: calc(100% - 24px);
  margin: 0;
  transition: 
    transform var(--duration-normal) var(--ease-out),
    opacity var(--duration-normal) var(--ease-out);
  
  transform: translateX(calc(var(--stack-pos) * 8px)) translateY(calc(var(--stack-pos) * 8px));
  z-index: calc(10 - var(--stack-pos));
  opacity: calc(1 - var(--stack-pos) * 0.12);
}

.stackFigure[data-active="true"] {
  position: relative;
  cursor: default;
  z-index: 100;
}

.figureStackContainer:focus-visible {
  outline: none;
}

.figureStackContainer:focus-visible .stackFigure[data-active="true"] .stackImagePlaceholder {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* Non-active figures - clickable with circle arrow cursor (mirrored to point right) */
.stackFigure:not([data-active="true"]) {
  cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 640 640' fill='%23737373'%3E%3Cpath transform='translate(640,0) scale(-1,1)' d='M320 96C443.7 96 544 196.3 544 320C544 443.7 443.7 544 320 544C196.3 544 96 443.7 96 320C96 196.3 196.3 96 320 96zM320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576zM228.7 308.7C222.5 314.9 222.5 325.1 228.7 331.3L300.7 403.3C306.9 409.5 317.1 409.5 323.3 403.3C329.5 397.1 329.5 386.9 323.3 380.7L278.6 336L400 336C408.8 336 416 328.8 416 320C416 311.2 408.8 304 400 304L278.6 304L323.3 259.3C329.5 253.1 329.5 242.9 323.3 236.7C317.1 230.5 306.9 230.5 300.7 236.7L228.7 308.7z'/%3E%3C/svg%3E") 12 12, pointer;
}

/* Hide figures beyond position 3 */
.stackFigure[style*="--stack-pos: 4"],
.stackFigure[style*="--stack-pos: 5"],
.stackFigure[style*="--stack-pos: 6"],
.stackFigure[style*="--stack-pos: 7"] {
  visibility: hidden;
}

.stackImagePlaceholder {
  width: 100%;
  background-color: var(--bg-secondary);
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-quaternary);
  position: relative;
}

.imageTag {
  position: absolute;
  left: 6px;
  bottom: 6px;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: var(--text-xs);
  font-weight: 500;
  color: var(--text-secondary);
  background: rgba(255, 255, 255, 0.65);
  border: 1px solid rgba(255, 255, 255, 0.4);
  backdrop-filter: blur(10px) saturate(160%);
  -webkit-backdrop-filter: blur(10px) saturate(160%);
  border: 1px solid var(--border-primary);
}

@media (prefers-color-scheme: dark) {
  .imageTag {
    color: var(--text-primary);
    background: rgba(10, 10, 10, 0.6);
    border-color: rgba(255, 255, 255, 0.12);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
  }
}

/* ========================================
 * Figure / Image Placeholder
 * ======================================== */

.figure {
  margin-top: var(--space-6);
}

.figure + .figure {
  margin-top: var(--space-4);
}

.imagePlaceholder {
  width: 100%;
  background-color: var(--bg-secondary);
  border: 1px solid var(--border-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-quaternary);
}

.caption {
  font-size: var(--text-sm);
  color: var(--text-tertiary);
  margin-top: var(--space-2);
  font-style: italic;
}

/* ========================================
 * Stats
 * ======================================== */

.statRow {
  display: flex;
  gap: var(--space-12);
  margin-bottom: var(--space-8);
}

.stat {
  display: flex;
  flex-direction: column;
  gap: var(--space-1);
}

.statValue {
  font-family: var(--font-serif);
  font-size: var(--text-xl);
  font-weight: 400;
  color: var(--text-primary);
  letter-spacing: -0.02em;
}

.statLabel {
  font-size: var(--text-base);
  font-weight: 500;
  color: var(--text-quaternary);
}

/* ========================================
 * Prose (Context, Learnings)
 * ======================================== */

.prose {
  font-size: var(--text-base);
  line-height: var(--leading-relaxed);
  color: var(--text-secondary);
}

.prose p + p {
  margin-top: var(--space-4);
}

.prose ul {
  margin-top: var(--space-4);
  padding-left: var(--space-4);
}

.prose li {
  margin-top: var(--space-2);
}

.prose li::marker {
  color: var(--text-quaternary);
}

.prose li {
  list-style-type: disc;
}

.subheading {
  font-family: var(--font-sans);
  font-size: var(--text-sm);
  font-weight: 500;
  color: var(--text-primary);
  margin-top: var(--space-8);
  margin-bottom: var(--space-3);
}

/* ========================================
 * Separator
 * ======================================== */

.separator {
  width: 3rem;
  height: 1px;
  background-color: var(--border-primary);
  margin: var(--space-20) 0;
}

/* ========================================
 * Next Case Study
 * ======================================== */

.nextSection {
  margin-top: var(--space-10);
}

.nextLabel {
  display: block;
  font-family: var(--font-sans);
  font-size: var(--text-xs);
  font-weight: 500;
  color: var(--text-quaternary);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: var(--space-4);
}

/* ========================================
 * Page Bottom Padding
 * ======================================== */

.pageBottom {
  height: var(--space-20);
}

/* Mobile layout overrides placed at end so they win cascade */
@media (max-width: 640px) {
  .hero {
    padding-top: var(--space-0);
  }

  .cover + .hero {
    padding-top: var(--space-12);
  }

  .heroTop .cover {
    margin-left: calc((100vw - 100%) / -2);
    margin-right: calc((100vw - 100%) / -2);
    margin-bottom: 0;
  }

  .heroTop .coverFrame {
    border-radius: 0;
    border-left: none;
    border-right: none;
    border-top: none;
  }

  .meta {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    align-items: start;
    gap: var(--space-8);
  }

  .metaItem:nth-child(3) {
    grid-column: 1 / -1;
  }

  .hook {
    margin-bottom: var(--space-8);
  }

  .heroSeparator {
    margin-top: var(--space-8);
    margin-bottom: var(--space-8);
  }

  .segmentedButton {
    width: 36px;
    height: 30px;
  }

  .separator {
    margin-top: var(--space-8);
    margin-bottom: var(--space-8);
  }

  .chapter,
  .stackSection {
    margin-top: var(--space-8);
  }

  .stickyTrack {
    height: auto;
    margin-bottom: 0;
  }

  .navOverlay {
    position: relative;
    top: auto;
    height: auto;
  }

  .blurOverlay {
    display: none;
  }

  .stackContainer {
    padding-right: 12px;
    padding-bottom: 12px;
    touch-action: pan-y;
  }

  .stackCard {
    width: 100%;
    transform: translateX(calc(var(--stack-pos) * 6px)) translateY(calc(var(--stack-pos) * 6px)) !important;
    opacity: calc(1 - var(--stack-pos) * 0.25) !important;
    z-index: calc(10 - var(--stack-pos));
    pointer-events: none;
    cursor: default !important;
  }

  .stackCard[data-active="true"] {
    pointer-events: auto;
    z-index: 100;
  }

  .stackCard[style*="--stack-pos: 3"],
  .stackCard[style*="--stack-pos: 4"],
  .stackCard[style*="--stack-pos: 5"],
  .stackCard[style*="--stack-pos: 6"],
  .stackCard[style*="--stack-pos: 7"] {
    visibility: hidden;
  }

  .figureStackContainer {
    display: grid;
    padding-right: 12px;
    padding-bottom: 12px;
    touch-action: pan-y;
  }

  .stackFigure {
    grid-area: 1 / 1;
    position: relative !important;
    width: 100% !important;
    transform: translateX(calc(var(--stack-pos) * 6px)) translateY(calc(var(--stack-pos) * 6px)) !important;
    opacity: calc(1 - var(--stack-pos) * 0.25) !important;
    z-index: calc(10 - var(--stack-pos));
    pointer-events: none;
    cursor: default !important;
  }

  .imageTag {
    display: none;
  }

  .stackFigure[data-active="true"] {
    pointer-events: auto;
    z-index: 100;
  }

  .stackFigure[style*="--stack-pos: 3"],
  .stackFigure[style*="--stack-pos: 4"],
  .stackFigure[style*="--stack-pos: 5"],
  .stackFigure[style*="--stack-pos: 6"],
  .stackFigure[style*="--stack-pos: 7"] {
    visibility: hidden;
  }

  .statRow {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
    margin-bottom: var(--space-8);
  }
}
